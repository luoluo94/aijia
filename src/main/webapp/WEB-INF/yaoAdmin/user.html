<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<input type="hidden" class="form-control" name="user_id" id="user_id">
<div class="list">
<div class="search">
    <form class="form-inline" role="form" id="list_form">
    <label class="inline">
        用户名称：<input type="text" class="form-control" name="name">
    </label>
        <button type="button" class="btn btn-default -btn search-btn" onclick="search()" style="margin-left: 100px;">查询</button>
        </form>
</div>
<div class="panel panel-default table-div">
<table class="table table-striped table-hover data-table" >
    <thead>
    <tr>
        <th>创建时间</th>
        <th width="150px">用户名称</th>
        <th>头像</th>
        <th>登录次数</th>
        <th>最后登录时间</th>
        <th>是否禁用</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody id="dataTable">
    <tr>
        <td colspan="10">暂无数据</td>
    </tr>
    </tbody>
</table>
    <nav aria-label="...">
        <ul class="pager">
            <li style="float: left;" id="recordsTotal"></li>
            <li class="pre disabled"><a href="#" onclick="previous(pageNum)" id="prea">Previous</a></li>
            <li class="ne"><a href="#" onclick="next(pageNum)" id="nea">Next</a></li>
        </ul>
    </nav>
    </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="myModal" style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">禁用／解禁理由</h4>
            </div>
            <div class="modal-body">
                禁用:  <input type="radio" value="true" name="is_banned">   解禁:  <input type="radio" value="false" name="is_banned">
                <textarea id="record_content" rows="10" cols="200" autofocus maxlength="250" required style="width: 500px;margin-top: 15px;"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="close()">关闭</button>
                <button type="button" class="btn btn-primary" onclick="save_ban()">确认</button>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    pageNum=1;

    function list(){
        $.ajax({
            url: adminPath+"/user/listUser"+page+pageNum,
            type:"POST",
            data:$("#list_form").serialize(),
            dataType:"json",
            error:function(){alert("出错了，请稍后再试")},
            success:function(result){
                $("#dataTable").empty();
                $.each(result.data, function (idx, val) {
                    var banned=val["banned"]=='0'?"正常":"已禁用";
                    $("#dataTable").append("<tr>"
                            +"<td width='200px'>"+val["create_time"]+"</td>"
                            +"<td width='200px'>"+val["name"]+"</td>"
                            +'<td><img width="40px" height="40px" src="'+val["header_url"]+'"></td>'
                            +"<td width='200px'>"+val["login_num"]+"</td>"
                            +"<td width='200px'>"+val["last_change_time"]+"</td>"
                            +"<td width='200px'>"+banned+"</td>"
                            +"<td><button type='button' onclick=ban(\'"+val['id']+"\')>禁用</button>"+"</td>"
                    );
                });
                if(result.data.length==0){
                    $("#dataTable").append('<tr><td colspan="10">暂无数据</td></tr>');
                }
                totalPage=result.total_page;
                $("#recordsTotal").html("总记录数："+result.records_total);
                if(parseInt(totalPage)==1){
                    $(".ne").addClass("disabled");
                }
            }
        });
    }

    list();

    function ban(id){
        $("#user_id").val(id);
        $('#myModal').modal('show');
    }

    function close(){
        $('#myModal').modal('hide');
    }
    function save_ban(){
        $.ajax({
            url: adminPath+"/user/ban",
            type:"POST",
            data:{
                "creator":$("#user_id").val(),
                "recordContent":$("#record_content").val(),
                "isBanned":$('input[name="is_banned"]:checked ').val()
            },
            dataType:"json",
            error:function(){alert("出错了，请稍后再试")},
            success:function(result){
                if(result.is_success) {
                    list();
                    $("#record_content").html('');
                    $('#myModal').modal('hide');
                }else{
                    alert("出错了，请稍后再试");
                }
            }
        });
    }

</script>
</html>